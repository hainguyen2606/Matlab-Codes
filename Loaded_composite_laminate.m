E1 = 181e9;
E2 = 10.3e9;
G12 = 7.17e9;
majorPr = 0.28;
minorPr = E2*majorPr/E1;
Q = zeros(3,3);
Q(1,1) = E1/(1-majorPr*minorPr);
Q(2,2) = E2/(1-majorPr*minorPr);
Q(1,2) = (majorPr*E2)/(1-majorPr*minorPr);
Q(2,1) = Q(1,2);
Q(3,3) = G12;
Q_30 = zeros(3,3);
Q_45 = zeros(3,3);
theta0 = deg2rad(0);
theta1 = deg2rad(30);
Q_30(1,1) = Q(1,1)*(cos(theta1)^4)+Q(2,2)*(sin(theta1)^4) + 2*(Q(1,2)+2*Q(3,3))*(sin(theta1)^2)*(cos(theta1)^2);
Q_30(1,2) = (Q(1,1) + Q(2,2)-4*Q(3,3))*(cos(theta1)*sin(theta1))^2 + Q(1,2)* (sin(theta1)^4 + cos(theta1)^4);
Q_30(2,2) = Q(1,1)*sin(theta1)^4 +Q(2,2)*cos(theta1)^4 + 2*(Q(1,2)+2*Q(3,3))*(sin(theta1)*cos(theta1))^2;
Q_30(1,3) = (Q(1,1) - Q(1,2) - 2*Q(3,3))*(cos(theta1)^3)*sin(theta1) - (Q(2,2) - Q(1,2) - 2*Q(3,3))*(sin(theta1)^3)*cos(theta1);
Q_30(2,3) = (Q(1,1) - Q(1,2) - 2*Q(3,3))*(sin(theta1)^3)*cos(theta1) - (Q(2,2) - Q(1,2) - 2*Q(3,3))*(cos(theta1)^3)*sin(theta1);
Q_30(3,3) = (Q(1,1) + Q(2,2) - 2*Q(1,2) - 2*Q(3,3))*(cos(theta1)*sin(theta1))^2 + Q(3,3)*(cos(theta1)^4 + sin(theta1)^4);
Q_30(2,1) = Q_30(1,2);
Q_30(3,1) = Q_30(1,3);
Q_30(3,2) = Q_30(2,3);
theta2 = deg2rad(-45); 
Q_45(1,1) = Q(1,1)*(cos(theta2)^4)+Q(2,2)*(sin(theta2)^4) + 2*(Q(1,2)+2*Q(3,3))*(sin(theta2)^2)*(cos(theta2)^2);
Q_45(1,2) = (Q(1,1) + Q(2,2)-4*Q(3,3))*(cos(theta2)*sin(theta2))^2 + Q(1,2)* (sin(theta2)^4 + cos(theta2)^4);
Q_45(2,2) = Q(1,1)*sin(theta2)^4 +Q(2,2)*cos(theta2)^4 + 2*(Q(1,2)+2*Q(3,3))*(sin(theta2)*cos(theta2))^2;
Q_45(1,3) = (Q(1,1) - Q(1,2) - 2*Q(3,3))*(cos(theta2)^3)*sin(theta2) - (Q(2,2) - Q(1,2) - 2*Q(3,3))*(sin(theta2)^3)*cos(theta2);
Q_45(2,3) = (Q(1,1) - Q(1,2) - 2*Q(3,3))*(sin(theta2)^3)*cos(theta2) - (Q(2,2) - Q(1,2) - 2*Q(3,3))*(cos(theta2)^3)*sin(theta2);
Q_45(3,3) = (Q(1,1) + Q(2,2) - 2*Q(1,2) - 2*Q(3,3))*(cos(theta2)*sin(theta2))^2 + Q(3,3)*(cos(theta2)^4 + sin(theta2)^4);
Q_45(2,1) = Q_45(1,2);
Q_45(3,1) = Q_45(1,3);
Q_45(3,2) = Q_45(2,3);
z = zeros(1,4);
z(1) = -7.5;
z(2) = -2.5;
z(3) = 2.5;
z(4) = 7.5;
A = zeros(3,3);
A = Q*(z(2) -z(1)) + Q_30*(z(3)-z(2)) + Q_45*(z(4)- z(3));
B = zeros (3,3);
B = 0.5*(Q*(z(2)^2 - z(1)^2)+Q_30*(z(3)^2-z(2)^2)+Q_45*(z(4)^2-z(3)^2));
D = zeros(3,3);
D = (1/3)*(Q*(z(2)^3 - z(1)^3)+ Q_30*(z(3)^3 - z(2)^3) + Q_45*(z(4)^3 - z(3)^3));
E = [A B;B D];
E = E/(10^9);
NM = [0.0008 0.0008 0 0 0 0];
NM = transpose(NM);
E_STAR = inv(E);
epsiK = E_STAR*NM;
epsi = [epsiK(1,1) epsiK(2,1) epsiK(3,1)];
epsi = transpose(epsi);
K = [epsiK(4,1) epsiK(5,1) epsiK(6,1)];
K = transpose(K);
epsi1 = epsi + z(1)*K;
epsi2 = epsi + z(2)*K;
epsi3 = epsi + z(3)*K;
epsi4 = epsi + z(4)*K;
sigma1top = Q*epsi1;
sigma1bot = Q*epsi2;
sigma2top = Q_30*epsi2;
sigma2bot = Q_30*epsi3;
sigma3top = Q_45*epsi3;
sigma3bot = Q_45*epsi4; 
T_0 = [cos(theta0)^2 sin(theta0)^2 2*cos(theta0)*sin(theta0);sin(theta0)^2 cos(theta0)^2 -2*cos(theta0)*sin(theta0); -cos(theta0)*sin(theta0) cos(theta0)*sin(theta0) cos(theta0)^2-sin(theta0)^2];
T_30 = [cos(theta1)^2 sin(theta1)^2 2*cos(theta1)*sin(theta1);sin(theta1)^2 cos(theta1)^2 -2*cos(theta1)*sin(theta1); -cos(theta1)*sin(theta1) cos(theta1)*sin(theta1) cos(theta1)^2-sin(theta1)^2];
T_45 = [cos(theta2)^2 sin(theta2)^2 2*cos(theta2)*sin(theta2);sin(theta2)^2 cos(theta2)^2 -2*cos(theta2)*sin(theta2); -cos(theta2)*sin(theta2) cos(theta2)*sin(theta2) cos(theta2)^2-sin(theta2)^2];
localSigma1Top = T_0*sigma1top;
localSigma1Bot = T_0*sigma1bot;
localSigma2Top = T_30*sigma2top;
localSigma2Bot = T_30*sigma2bot;
localSigma3Top = T_45*sigma3top;
localSigma3Bot = T_45*sigma3bot;
R = [1 0 0;0 1 0; 0 0 2];
localEpsi1Top = R*T_0*inv(R)*epsi1;
localEpsi1Bot = R*T_0*inv(R)*epsi2;
localEpsi2Top = R*T_30*inv(R)*epsi2;
localEpsi2Bot = R*T_30*inv(R)*epsi3;
localEpsi3Top = R*T_45*inv(R)*epsi3;
localEpsi3Bot = R*T_45*inv(R)*epsi4;
zMid = [-5,0,5];
epsi1Mid = epsi + zMid(1)*K;
epsi2Mid = epsi+ zMid(2)*K;
epsi3Mid = epsi + zMid(3)*K;
sigma1Mid = Q*epsi1Mid;
sigma2Mid = Q_30*epsi2Mid;
sigma3Mid = Q_45*epsi3Mid;
Nxy1 = abs(sigma1Mid(3)*abs(zMid(1))*10^(-3));%zMid(1) dai dien cho chieu day tam 5mm
Nxy2 = abs(sigma2Mid(3)*abs(zMid(1))*10^(-3));
Nxy3 = abs(sigma3Mid(3)*abs(zMid(1))*10^(-3));
percentNxy1 = (Nxy1*100)/(Nxy1+Nxy2+Nxy3);
percentNxy2 = (Nxy2*100)/(Nxy1+Nxy2+Nxy3);
percentNxy3 = 100-percentNxy2-percentNxy1;
localSigma1Mid  =T_0*sigma1Mid;
localSigma2Mid = T_30*sigma2Mid;
localSigma3Mid = T_45*sigma3Mid; 
